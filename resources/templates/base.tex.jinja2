\documentclass[11pt,a4paper]{article}
\usepackage[top=2cm, bottom=2cm, left=1.5cm, right=1.5cm]{geometry}
\usepackage{titlesec}
\usepackage{enumitem}
\usepackage[hidelinks]{hyperref}
\usepackage{setspace}
\usepackage{helvet}
\usepackage[none]{hyphenat}
\sloppy

{% raw -%}
\newcommand{\tagbox}[1]{%
  \begingroup
    \setlength{\fboxsep}{0pt}%
    \raisebox{0.2ex}[1.2em][0.8em]{%
        \fbox{\hspace{2pt}\raisebox{-0.2em}[1em][0.6em]{\textbf{#1}}\hspace{2pt}}%
    }%
  \endgroup
}
{%- endraw %}

\renewcommand{\familydefault}{\sfdefault}

{% raw -%}
% Espaciado entre secciones
\titlespacing*{\section}{0pt}{10pt}{4pt}
\titlespacing*{\subsection}{0pt}{6pt}{2pt}

% Formato de títulos
\titleformat{\section}{\large\bfseries\uppercase}{ }{0pt}{}
\titleformat{\subsection}{\normalsize\bfseries}{ }{0pt}{}

% Sin sangría
\setlength{\parindent}{0pt}
\setlength{\parskip}{4pt}
{%- endraw %}

{%- set personal_info = person['personal_info'] -%}
{%- set summary = person.get('summary') -%}
{%- set experiences = person.get('experiences') -%}
{%- set education = person.get('education') -%}
{%- set skill_categories = person.get('skill_categories') -%}
{%- set projects = person.get('projects') -%}
{%- set certifications = person.get('certifications') -%}
{%- set references = person.get('references') -%}

\begin{document}

% ======= HEADER =======
\begin{center}
    {\LARGE \textbf{ {{- personal_info['lastname'] | latex_escape -}}, {{ personal_info['name'] | latex_escape }} }}\\
    \vspace{4pt}
    \href{mailto:{{ personal_info['email'] | latex_escape }}}{{ "{" }}{{ personal_info['email'] | latex_escape }}{{ "}" }} \,•\,
    {{ personal_info['phone'] | latex_escape }}
    {%- if personal_info['links'] %}
        {%- for link in personal_info['links'] %} \,•\, \href{ {{- link['url'] | latex_escape -}} }{ {{- link['name'] | latex_escape -}} }{% endfor -%}
    {%- endif %}
\end{center}

{% if summary -%}
\section*{ {{- titles['summary'] | latex_escape -}} }
{{ summary | latex_escape }}

{% endif -%}

{%- if experiences -%}
\section*{ {{- titles['experiences'] | latex_escape -}} }
{% for exp in experiences -%}
\textbf{ {{- exp['position'] | latex_escape -}} }, \textit{ {{- exp['company'] | latex_escape -}} }\\
\textit{ {{- exp['period'] | latex_escape -}} }
{%- if exp['tasks'] %}
{% raw -%}
\begin{itemize}[leftmargin=1.2em, topsep=2pt]
{%- endraw %}
{%- for task in exp['tasks'] %}
    \item {{ task | latex_escape }}
{%- endfor %}
{% raw -%}
\end{itemize}
{%- endraw %}
{%- endif %}
{%- if exp['skills'] %}
\noindent\textbf{Habilidades: }
{%- for sk in exp['skills'] %} \tagbox{ {{- sk | latex_escape -}} }{% endfor %}

{% endif -%}
{% if not loop.last %}\vspace{8pt}

{% endif -%}
{% endfor -%}
{%- endif -%}

{%- if education -%}
\section*{ {{- titles['education'] | latex_escape -}} }
{% for edu in education -%}
\textbf{ {{- edu['degree'] | latex_escape -}} }, \textit{ {{- edu['institution'] | latex_escape -}} }\\
\textit{ {{- edu['period']['start'] -}} - {{ edu['period']['end'] -}} }
{%- if edu['description'] %}\\
{{ edu['description'] | latex_escape }}
{%- endif %}
{% if not loop.last %}
\vspace{6pt}\\
{% endif -%}
{% endfor %}
{%- endif -%}

{%- if skill_categories -%}
\section*{ {{- titles['skill_categories'] | latex_escape -}} }
{% for cat in skill_categories -%}
{%- if cat.get('items') -%}
\textbf{ {{- cat.get('category') | latex_escape -}}: } {{ cat.get('items') | join(', ') | latex_escape }}\\
{%- endif -%}
{% endfor %}
{%- endif -%}

{%- if projects -%}
\section*{ {{- titles['projects'] | latex_escape -}} }
{% for p in projects -%}
\textbf{ {{- p['name'] | latex_escape -}} }\\
{{ p['description'] | latex_escape }}\\
{%- if p['technologies'] %}
\textbf{Tecnologías: } {{ p['technologies'] | join(', ') | latex_escape }}\\
{%- endif %}
{%- if p['repo'] %}
\textbf{Repositorio: } \href{ {{- p['repo'] | latex_escape -}} }{ {{- p['repo'] | latex_escape -}} }\\
{%- endif %}
{% if not loop.last %}
\vspace{6pt}
{% endif -%}
{% endfor -%}
{%- endif -%}

{%- if certifications -%}
\section*{ {{- titles['certifications'] | latex_escape -}} }
{% raw -%}
\begin{itemize}[leftmargin=1.2em]
{%- endraw %}
{%- for c in certifications %}
    \item {{ c | latex_escape }}
{%- endfor %}
{% raw -%}
\end{itemize}
{%- endraw %}

{%- endif -%}

{%- if references -%}
\section*{ {{- titles['references'] | latex_escape -}} }
{% for r in references -%}
\textbf{ {{- r['name'] | latex_escape -}} }, \textit{ {{- r['position'] | latex_escape -}}, {{ r['company'] | latex_escape }} }\\
{%- if r['note'] %}
{{ r['note'] | latex_escape }}\\
{%- endif %}
\textbf{Email:} \href{mailto:{{ r['email'] | latex_escape }}}{{ "{" }}{{ r['email'] | latex_escape }}{{ "}" }}
{%- if r['phone'] %} \,•\, \textbf{Tel:} {{ r['phone'] | latex_escape }}{% endif %}
{% if not loop.last %}\vspace{8pt}\\{% endif %}
{% endfor -%}
{%- endif %}

\end{document}
